import{h}from"@stencil/core";import{sprintf,__,_x}from"@wordpress/i18n";import{speak}from"@wordpress/a11y";import{intervalString}from"../../../../functions/price";import{state as checkoutState}from"../../../../store/checkout/index";import{addCheckoutLineItem,removeCheckoutLineItem,trackOrderBump}from"../../../../store/checkout/mutations";export class ScOrderBump{constructor(){this.bump=void 0,this.showControl=void 0}lineItem(){var i,e,t;return null===(t=null===(e=null===(i=null==checkoutState?void 0:checkoutState.checkout)||void 0===i?void 0:i.line_items)||void 0===e?void 0:e.data)||void 0===t?void 0:t.find((i=>{var e;return(null==i?void 0:i.bump)===(null===(e=this.bump)||void 0===e?void 0:e.id)}))}updateLineItem(){var i,e,t,o;const d=(null===(i=this.bump.price)||void 0===i?void 0:i.id)||(null===(e=this.bump)||void 0===e?void 0:e.price);if(this.lineItem())return removeCheckoutLineItem(null===(t=this.lineItem())||void 0===t?void 0:t.id),void speak(__("Order bump Removed.","surecart"));addCheckoutLineItem({bump:null===(o=this.bump)||void 0===o?void 0:o.id,price:d,quantity:1}),speak(__("Order bump applied.","surecart"))}componentDidLoad(){var i;trackOrderBump(null===(i=this.bump)||void 0===i?void 0:i.id)}newPrice(){var i,e,t,o,d,a;let r=null,u=(null===(e=null===(i=this.bump)||void 0===i?void 0:i.price)||void 0===e?void 0:e.amount)||0;if((null===(t=this.bump)||void 0===t?void 0:t.amount_off)&&(r=Math.max(0,u-(null===(o=this.bump)||void 0===o?void 0:o.amount_off))),null===(d=this.bump)||void 0===d?void 0:d.percent_off){const i=u*((null===(a=this.bump)||void 0===a?void 0:a.percent_off)/100);r=Math.max(0,u-i)}return r}renderInterval(){var i;const e=intervalString(null===(i=this.bump)||void 0===i?void 0:i.price,{labels:{interval:"/",period:__("for","surecart")}});return e.trim().length?h("span",{class:"bump__interval"},e):null}renderPrice(){var i,e,t,o,d,a,r,u,n;return h("div",{slot:"description",class:{bump__price:!0,"bump__price--has-discount":!!(null===(i=this.bump)||void 0===i?void 0:i.percent_off)||!!(null===(e=this.bump)||void 0===e?void 0:e.amount_off)},part:"price"},!(!(null===(t=this.bump)||void 0===t?void 0:t.percent_off)&&!(null===(o=this.bump)||void 0===o?void 0:o.amount_off))&&h("span",{"aria-label":
/** translators: %s: old price */
sprintf(__("Originally priced at %s.","surecart"),null===(d=this.bump)||void 0===d?void 0:d.subtotal_display_amount),class:"bump__original-price"},null===(a=this.bump)||void 0===a?void 0:a.subtotal_display_amount),h("span",null,h("span",{"aria-hidden":"true"},0===(null===(r=this.bump)||void 0===r?void 0:r.total_amount)&&__("Free","surecart"),(null===(u=this.bump)||void 0===u?void 0:u.total_amount)>0&&h("span",{class:"bump__new-price"},null===(n=this.bump)||void 0===n?void 0:n.total_display_amount),this.renderInterval())))}renderDiscount(){var i,e,t,o,d,a,r;return(null===(i=this.bump)||void 0===i?void 0:i.amount_off)?h("div",{class:"bump__tag","aria-label":
/** translators: %1$s: amount off, %2$s: currency */
sprintf(__("You save %1$s%2$s.","surecart"),null===(e=this.bump)||void 0===e?void 0:e.amount_off,(null===(t=this.bump)||void 0===t?void 0:t.price).currency)},h("span",{"aria-hidden":"true"},_x("Save","Save money","surecart")," ",null===(o=this.bump)||void 0===o?void 0:o.amount_off_display_amount)):(null===(d=this.bump)||void 0===d?void 0:d.percent_off)?h("div",{class:"bump__tag","aria-label":
/** translators: %s: amount percent off */
sprintf(__("You save %s%%.","surecart"),null===(a=this.bump)||void 0===a?void 0:a.percent_off)},h("span",{"aria-hidden":"true"},sprintf(
/** translators: %s: amount percent off */
_x("Save %s%%","Save money","surecart"),null===(r=this.bump)||void 0===r?void 0:r.percent_off))):void 0}render(){var i,e,t,o,d,a,r,u,n,l,s,c,p,v,m,b,_,f,y,k;const g=null===(e=null===(i=this.bump)||void 0===i?void 0:i.price)||void 0===e?void 0:e.product;return h("sc-choice",{key:"983d78c5de4e40b4d66f6e755e49000c3ba2e07f",value:null===(t=this.bump)||void 0===t?void 0:t.id,type:"checkbox",showControl:this.showControl,checked:!!this.lineItem(),onClick:i=>{i.preventDefault(),i.stopImmediatePropagation(),this.updateLineItem()},onKeyDown:i=>{"Enter"!==i.key&&" "!==i.key||(i.preventDefault(),i.stopImmediatePropagation(),this.updateLineItem())},exportparts:"base, control, checked-icon, title"},h("div",{key:"54a1819dbbfc23855d4a0920cd853973077fcb58",part:"base-content",class:"bump"},h("div",{key:"6261d9ede9267a35093f1271bcf48c98840cd605",class:"bump__text"},h("div",{key:"8eb1bd33b2592dc8358720b53ca3640bd03fd8b0",class:"bump__title","aria-label":sprintf(
/* translators: %s: order bump name */
__("Product: %s.","surecart"),(null===(d=null===(o=this.bump)||void 0===o?void 0:o.metadata)||void 0===d?void 0:d.cta)||(null===(a=this.bump)||void 0===a?void 0:a.name)||(null==g?void 0:g.name))},h("span",{key:"fd3214f1fc3f0e0bdd909d92d96339cc2a1b86a4","aria-hidden":"true"},(null===(u=null===(r=this.bump)||void 0===r?void 0:r.metadata)||void 0===u?void 0:u.cta)||(null===(n=this.bump)||void 0===n?void 0:n.name)||(null==g?void 0:g.name))),h("div",{key:"ef1e4657efc6dc4755641de2154d49e405f4d484",class:"bump__amount"},this.renderPrice(),this.renderDiscount()))),(null===(s=null===(l=this.bump)||void 0===l?void 0:l.metadata)||void 0===s?void 0:s.description)&&h("div",{key:"2e3a416ed1918562a4c1f49113cba05729b87ec3",slot:"footer",class:"bump__product--wrapper"},h("sc-divider",{key:"4d06a09e82fd1ecd41c01bdb048c5a76b0e33d69",style:{"--spacing":"var(--sc-spacing-medium)"}}),h("div",{key:"38c660a40700423b3f3a727f1db8f164a736daeb",class:"bump__product"},!!(null===(c=null==g?void 0:g.line_item_image)||void 0===c?void 0:c.src)&&h("img",{key:"df9c423d1eceadc3e61bc3530ae79c8bbb44a684",...null==g?void 0:g.line_item_image,class:"bump__image"}),h("div",{key:"0698bdcb6b3029cdccb97c5e7dc356cd60d3dab9",class:"bump__product-text"},!!(null===(v=null===(p=this.bump)||void 0===p?void 0:p.metadata)||void 0===v?void 0:v.cta)&&h("div",{key:"6f717ff6352c7fc1c48a4e29a934435bbb9406f1",class:"bump__product-title","aria-hidden":"true"},this.bump.name||(null==g?void 0:g.name)),!!(null===(b=null===(m=this.bump)||void 0===m?void 0:m.metadata)||void 0===b?void 0:b.description)&&h("div",{key:"33954453b45828dd93b7be7bf570366301d53c01",class:"bump__product-description","aria-label":sprintf(
/* translators: %s: Product description */
__("Product description: %s.","surecart"),null===(f=null===(_=this.bump)||void 0===_?void 0:_.metadata)||void 0===f?void 0:f.description)},h("span",{key:"011b6f194dda5c0a53cf3d7b2ebd9280891c3062","aria-hidden":"true"},null===(k=null===(y=this.bump)||void 0===y?void 0:y.metadata)||void 0===k?void 0:k.description))))))}static get is(){return"sc-order-bump"}static get encapsulation(){return"shadow"}static get originalStyleUrls(){return{$:["sc-order-bump.scss"]}}static get styleUrls(){return{$:["sc-order-bump.css"]}}static get properties(){return{bump:{type:"unknown",mutable:!1,complexType:{original:"Bump",resolved:"Bump",references:{Bump:{location:"import",path:"../../../../types",id:"src/types.ts::Bump"}}},required:!1,optional:!1,docs:{tags:[],text:"The bump"}},showControl:{type:"boolean",mutable:!1,complexType:{original:"boolean",resolved:"boolean",references:{}},required:!1,optional:!1,docs:{tags:[],text:"Should we show the controls"},attribute:"show-control",reflect:!0}}}}